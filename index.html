<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>PopCraft — Aperçu 3D Debug</title>
  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    header {
      position: relative;
      height: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: black;
    }
    header::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, #06c9d8 50%, transparent 50%);
      opacity: 0.2;
    }
    header img {
      position: relative;
      max-height: 140px;
    }
    #preview {
      position: absolute;
      top: 160px;
      bottom: 0;
      left: 0;
      right: 0;
    }
    #error {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.7);
      padding: 16px 24px;
      border-radius: 8px;
      font-size: 18px;
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <img src="popcraft_title.png" alt="PopCraft" />
  </header>
  <div id="preview"></div>
  <div id="error"></div>

  <!-- three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/loaders/OBJLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    const container = document.getElementById("preview");
    const errorBox = document.getElementById("error");

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.5, 3);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight-160);
    container.appendChild(renderer.domElement);

    const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
    scene.add(light);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;
    controls.enablePan = false;
    controls.minDistance = 2;
    controls.maxDistance = 5;
    controls.maxPolarAngle = Math.PI/2; // limite: pas aller dessous

    // Charger la texture et le modèle
    const texLoader = new THREE.TextureLoader();
    texLoader.load("box_template_blank.png", texture => {
      const objLoader = new THREE.OBJLoader();
      objLoader.load("pop.obj", object => {
        object.traverse(child => {
          if (child.isMesh) {
            child.material = new THREE.MeshStandardMaterial({map: texture});
          }
        });
        object.scale.set(1,1,1);
        object.position.y = -1.2;
        scene.add(object);
      }, undefined, err => showError("Erreur: impossible de charger pop.obj"));
    }, undefined, err => showError("Erreur: impossible de charger box_template_blank.png"));

    function showError(msg){
      errorBox.style.display = "block";
      errorBox.textContent = msg;
    }

    window.addEventListener("resize", ()=>{
      camera.aspect = window.innerWidth / (window.innerHeight-160);
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight-160);
    });

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
